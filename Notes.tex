% https://www.overleaf.com/learn/latex/font_typefaces
\documentclass[10pt, a4paper, onecolumn, openany]{book}         %openany make chpater start whenever, DELETE in OFFICIAL

% maketitle options
\title{\textbf{Gentoo Installation}}
\author{Patrik Rajtak}
\date{February, 2021}

% packages:
% font encoding
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{fancyhdr}       % fancy page header options
\usepackage{titlesec}       % used to have \thechapter in same line as \chaptertitlename
\usepackage{hyperref}       % \url
\usepackage{xcolor}         % colors
% Colors in verbatim:
\usepackage{fancyvrb} % https://ctan.math.illinois.edu/macros/latex/contrib/fancyvrb/doc/fancyvrb-doc.pdf

% 2 decorative lines on top and bottom
\renewcommand{\headrulewidth}{2pt}
\renewcommand{\footrulewidth}{2pt}

% normal pages style
\pagestyle{fancy}           % better header
\fancyhf{}                  % clear header and adjust as wanted:
    \chead{\leftmark}       % header
    \cfoot{Page \thepage}   % footer

\renewcommand{\chaptername}{}   % change word chapter to {}
% Chapter in same line as chapter name
\titleformat{\chapter}[hang] 
{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter.}{1em}{} 
% redefine play style used by chapter
\fancypagestyle{plain}{%
\fancyhf{} 
% clear header and adjust as wanted:
    \chead{\leftmark}       % header
    \cfoot{Page \thepage}   % footer
}

% sizes of chapters
\titleformat*{\section}{\LARGE\bfseries}
\titleformat*{\subsection}{\Large\bfseries}
\titleformat*{\subsubsection}{\large\bfseries}

\setlength{\parindent}{0pt} % disable paragrapg indent

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% DO NOT TOUCH ABOVE %%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Color examples
% \definecolor{MyColor}{RGB}{219, 48, 122} % example
% \textcolor{MyColor}{Some random text} % usage

\definecolor{root}{RGB}{222, 0, 0}
\definecolor{user}{RGB}{0, 150, 00}
\definecolor{dir}{RGB}{0, 100, 200}
\definecolor{file}{RGB}{77, 187, 101}
\definecolor{block}{RGB}{255, 80, 0}
\definecolor{command}{RGB}{41, 182, 0}
\definecolor{comment}{RGB}{0, 182, 182}

% Verbatim preset
%\begin{Verbatim}[commandchars=\\\{\}, frame=lines, framerule=0.5mm, framesep=3mm]
%\end{Verbatim}

%\long\def\/*#1*/{}

\usepackage[T1]{fontenc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% START %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
\maketitle                  % title
\clearpage                 % official blank page
\small
%\textcolor{root}{root#} 
%\textcolor{user}{user\$} 

\tableofcontents

\chapter{Flash USB}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Check for Bad Sectors}
\textbf{Block:} = every file must occupy at least 1 block. 0b file occupy whole block.\newline
512b = good for lot of small files. More blocks = more metadata.\newline
4096b =  good for larger files, less metadata. Waste if there are small files.
\subsection{OPTIONAL - Get More Info}
\begin{Verbatim}[commandchars=\\\{\}]
- Info about block devices:
\textcolor{user}{user\$}  \textcolor{command}{lsblk} [-ap | -apf]
\textcolor{root}{root#}  \textcolor{command}{fdisk -l} <\textcolor{block}{/dev/sdX}>
\textcolor{root}{root#}  \textcolor{command}{blkid}

- Get disk blocksize in bytes:
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getbsz <\textcolor{block}{/dev/sdX[Y]}>

- Get disk size in bytes:
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getsize64 <\textcolor{block}{/dev/sdX[Y]}>

- Check if device is readonly (1 = ro, 0 = rw):
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getro <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}

\subsection{Check}
\begin{Verbatim}[commandchars=\\\{\}]
HAVE UMOUNTED FS!!!

- Check for bad blocks:
\textcolor{root}{root#} \textcolor{command}{badblocks} [-b 4096] [-w [-t 0xaa]] [-v] [-s] [-o <FILE>] <\textcolor{block}{/dev/sdX[Y]}>
# -w = write patterns to every byte (0xaa)
\end{Verbatim}

\section{Flash ISO to USB}
\subsection{Fast Flash}
\begin{Verbatim}[commandchars=\\\{\}]
HAVE UMOUNTED FS!!!
    \textcolor{root}{root#} \textcolor{command}{dd} if=<\textcolor{file}{/<PATH>/<ISO.iso>}> of=<\textcolor{block}{/dev/sdX}> [bs=4M | status=progress]
\end{Verbatim}


\subsection{Multiboot USB - NOT WORKING}
\begin{Verbatim}[commandchars=\\\{\}]
HAVE UMOUNTED FS!!!

0. Run parted:
    \textcolor{root}{root#} \textcolor{command}{parted} [-a optimal] <\textcolor{block}{/dev/sdX}>

1. Create Partition Table:
    \textcolor{user}{(parted)} mklabel msdos
    
2. Set Unit Size:
    \textcolor{user}{(parted)} unit mib
    
3. Create Prtitions
3.1 UEFI partition:
    \textcolor{user}{(parted)} primary 1 551
    \textcolor{user}{(parted)} set 1 boot on
    \textcolor{user}{(parted)} set 1 esp on
3.2 Data partition:
    \textcolor{user}{(parted)} mkpart primary 551 100\%

4. Create FS
4.1 EFI FS:
    \textcolor{root}{root#} \textcolor{command}{mkfs} -t vfat <\textcolor{block}{/dev/sdX1}>
4.2 Data FS:
    \textcolor{root}{root#} \textcolor{command}{mkfs} -t ext4 <\textcolor{block}{/dev/sdX2}>
    
5. Mount Partitions:
    \textcolor{root}{root#} \textcolor{command}{mount} <\textcolor{block}{/dev/sdX1}> <\textcolor{dir}{/mnt/boot/}>
    \textcolor{root}{root#} \textcolor{command}{mount} <\textcolor{block}{/dev/sdX2}> <\textcolor{dir}{/mnt/data/}>

6. Install GRUB
6.1 Install for legacy:
    \textcolor{root}{root#} \textcolor{command}{grub2-install} --target=i386-pc --recheck 
    --boot-directory="<\textcolor{dir}{/mnt/data/boot/}>" <\textcolor{block}{/dev/sdX}>
6.2 Install for EFI:
    \textcolor{root}{root#} \textcolor{command}{grub2-install} --target=x86_64-efi --recheck --removable
    --efi-directory="<\textcolor{dir}{/mnt/boot/}>" --boot-directory="<\textcolor{dir}{/mnt/data/boot/}>"

7. Create grub.cfg and ISO directory
    \textcolor{root}{root#} \textcolor{command}{mkdir} <\textcolor{dir}{/mnt/data/iso/}>
    \textcolor{root}{root#} \textcolor{command}{touch} <\textcolor{file}{/mnt/data/boot/grub/grub.cfg}>

8. Copy ISO files to /mnt/data/
    \textcolor{root}{root#} \textcolor{command}{cp} <\textcolor{file}{/PATH/ISO.iso}> <\textcolor{dir}{/mnt/data/iso/}>
    
9. Configure grub.cfg
FILE: \textcolor{file}{/mnt/data/boot/grub/grub.cfg}

menuentry "<Gentoo>" \{
    isofile="/iso/<ISO.iso>"
    loopback loop "\$\{isofile\}"
    linux (loop)</boot/gentoo> root=/dev/ram0 init=/linuxrc dokeymap
looptype=squashfs 
    loop=/image.squashfs cdroot
    initrd (loop)</boot/gentoo.igz>
\}
menuentry "<Kali>" \{
    isofile="/iso/<ISO.iso>"
    loopback loop "\$\{isofile\}"
    linux (loop)</install.amd/vmlinuz pressed/file=/cdrom/simple-cdd/default.pressed
simple-cdd/profiles=kali,offline desktop=xfce vga=788 --- quiet> 
    initrd (loop)</casper/initrd>
\}
TIP: kernel and initrd can be found by mounitng iso and check for grub.cfg

THERE ARE STILL PROBLEMS WITH THIS VARIANT!!!
\end{Verbatim}




\chapter{Gentoo Disk Partitioning}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Disk Partitioning Map}
\textbf{Partition Tables:}
\begin{itemize}
    \item MBR
    \item GPT $<-$
\end{itemize}
\textbf{Partitioning:}\newline
/dev/sdX
\begin{Verbatim}
NAME        MOUNT   SIZE    FS      DESCRIPTION  
/dev/sda1   N/A     2MB     N/A     BIOS boot partition (GRUB data)
/dev/sda2   /boot   512MB   fat32   Boot/EFI system partition 
/dev/sda3   N/A     100\%   crypto  LVM
|-> /dev/mapper/lvm/            N/A     100\%       LVM2_m
    |-> /dev/mapper/vg0-swap    N/A     4GB         [SWAP]
    |-> /dev/mapper/vg0-swap    /       100\%FREE   ext4
\end{Verbatim}

\section{Disk Partitioning}
\begin{Verbatim}[commandchars=\\\{\}]
HAVE UMOUNTED FS!!!

0. Run parted:
    \textcolor{root}{root#} \textcolor{command}{parted} [-a optimal] <\textcolor{block}{/dev/sdX}>

1. Create Partition Table:
    \textcolor{user}{(parted)} mklabel gpt
    
2. Set Unit Size:
    \textcolor{user}{(parted)} unit mib
    
3. Create Prtitions
3.1 BIOS partition (1-2 MiB):
    \textcolor{user}{(parted)} mkpart primary 1 2
    \textcolor{user}{(parted)} name 1 bios
    \textcolor{user}{(parted)} set 1 bios_grub on
3.2 EFI partition (100-512 MiB):
    \textcolor{user}{(parted)} mkpart primary 2 514
    \textcolor{user}{(parted)} name 2 boot
    \textcolor{user}{(parted)} set 2 boot on
3.3 LVM partition:
    \textcolor{user}{(parted)} mkpart primary 514 -1
    \textcolor{user}{(parted)} name 3 lvm
    \textcolor{user}{(parted)} set 3 lvm on

4 Create EFI Partition FS:
    \textcolor{root}{root#} \textcolor{command}{mkfs} -t vfat <\textcolor{block}{/dev/sdX2}>

5. Encrypt partition with LUKS
5.1 Create encrypted partition:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} luksFormat <\textcolor{block}{/dev/sdX3}>
5.2 Open LUKS:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} open --type luks <\textcolor{block}{/dev/sdX3}> <lvm>
Note: name (lvm) can be whatever or found with: "root# blkid"

OPTIONAL LUKS STUFF:
- Close LUKS:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} close <lvm>
- See LUKS header
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} luksDump <\textcolor{block}{/dev/sdX3}>
- Make LUKS header backup:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} luksHeaderBackup <\textcolor{block}{/dev/sdX3}> --header-backup-file <\textcolor{file}{FILE}>
- destroy LUKS header:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} luksErase <\textcolor{block}{/dev/sdX3}>
- restore LUKS header from backup:
    \textcolor{root}{root#} \textcolor{command}{cryptsetup} luksHeaderRestore <\textcolor{block}{/dev/sdX3}> --header-backup-file <\textcolor{file}{FILE}>

6. Create LVM on partiton
6.1 Initialize disk/partition for use by LVM:
    \textcolor{root}{root#} \textcolor{command}{lvm} pvcreate <\textcolor{block}{/dev/mapper/lvm}>
6.2 Create volume group "vg0":
    \textcolor{root}{root#} \textcolor{command}{vgcreate} <vg0> <\textcolor{block}{/dev/mapper/lvm}>
6.3 Create Logical volumes
6.3.1 Logical volume for swap in size 16GB:
    \textcolor{root}{root#} \textcolor{command}{lvcreate} -L 16G -n swap <vg0>
6.3.2 Logical volume for root (and everything else) 100\% free space:
    \textcolor{root}{root#} \textcolor{command}{lvcreate} -l 100\%FREE -n root <vg0>

7. Filesystems for LVM
7.1 Swap filesystem:
    \textcolor{root}{root#} \textcolor{command}{mkswap} <\textcolor{block}{/dev/mapper/vg0-swap}>
    \textcolor{root}{root#} \textcolor{command}{swapon} <\textcolor{block}{/dev/mapper/vg0-swap}>
7.2 root ext4 filesystem:
    \textcolor{root}{root#} \textcolor{command}{mkfs} -t ext4 <\textcolor{block}{/dev/mapper/vg0-root}>
\end{Verbatim}



\chapter{Gentoo Installation}
\section{Mount to Gentoo}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{mount} <\textcolor{block}{/dev/mapper/vg0-root}> \textcolor{dir}{/mnt/gentoo/}
\end{Verbatim}

\section{Check Date}
\begin{Verbatim}[commandchars=\\\{\}]
1. Verify Date:
    \textcolor{root}{root#} \textcolor{command}{date}

OPTIONAL:
A) Setup with ntp.org:
    \textcolor{root}{root#} \textcolor{command}{ntpd} -q -g
B) Setup manually MMDDhhmmYYYY (01.02.2021 12:00):
    \textcolor{root}{root#} \textcolor{command}{date} 020112002021
\end{Verbatim}

\section{Stage 3}
\begin{Verbatim}[commandchars=\\\{\}]
1. Download tarball:
    \textcolor{root}{root#}\textcolor{dir}{ /mnt/gentoo#} \textcolor{command}{links} https://www.gentoo.org/downloads/
Move to: "Stage3";
stage3-amd64-<release>.tar.xz (’D’ to download);
stage3-amd64-<release>.tar.xz.DIGESTS.asc (’D’ to download);

OPTIONAL: Verify checksum:
    \textcolor{root}{root#} \textcolor{command}{sha512sum} <\textcolor{file}{stage3-amd64-<release>.tar.xz}>
    \textcolor{root}{root#} \textcolor{command}{grep} -A 1 -i "sha512" <\textcolor{file}{stage3-amd64-<release>.tar.xz.DIGESTS.asc}>

2. Unpack tarball:
    \textcolor{root}{root#} \textcolor{command}{tar} xpvf \textcolor{file}{stage3-*.tar.xz} --xattrs-include=’*.*’ --numeric-owner
\end{Verbatim}

\section{Config Compile options and Repos}
\subsection{Compile Options}
For full config see section (\underline{\ref{make.conf}})


\subsection{Repos}
\begin{Verbatim}[commandchars=\\\{\}]
1. Repos Configuration2.1 Mirror selection:
\textcolor{root}{root#} \textcolor{command}{mirrorselect} -i -o >> \textcolor{file}{/mnt/gentoo/etc/portage/make.conf}
"Space" -> select mirror

2. Create repository dir if !exists:
\textcolor{root}{root#} \textcolor{command}{mkdir} -p \textcolor{dir}{/mnt/gentoo/etc/portage/repos.conf/}
2.3 Copy portage repos.conf to new repos.conf
\textcolor{root}{root#} \textcolor{command}{cp} \textcolor{file}{/mnt/gentoo/usr/share/portage/config/repos.conf} 
\textcolor{file}{/mnt/gentoo/etc/portage/repos.conf/gentoo.conf}
\end{Verbatim}

\section{Chroot with mounting FS}
\begin{Verbatim}[commandchars=\\\{\}]
1. Mount necessary filesystems:
    \textcolor{root}{root#} \textcolor{command}{mount} -t proc \textcolor{dir}{/proc/} \textcolor{dir}{/mnt/gentoo/proc/}
    \textcolor{root}{root#} \textcolor{command}{mount} --rbind \textcolor{dir}{/sys/} \textcolor{dir}{/mnt/gentoo/sys/}
    \textcolor{root}{root#} \textcolor{command}{mount} --make-rslave \textcolor{dir}{/mnt/gentoo/sys/}
    \textcolor{root}{root#} \textcolor{command}{mount} --rbind \textcolor{dir}{/dev/} \textcolor{dir}{/mnt/gentoo/dev/}
    \textcolor{root}{root#} \textcolor{command}{mount} --make-rslave \textcolor{dir}{/mnt/gentoo/dev/}

2.1 Enter chroot:
    \textcolor{root}{root#} \textcolor{command}{chroot} \textcolor{dir}{/mnt/gentoo/} \textcolor{file}{/bin/bash}
    \textcolor{root}{root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
2.2 Change command prompt to see, that we are rooted:
    \textcolor{root}{root#} \textcolor{command}{export} PS1="(chroot) \$\{PS1\}"

3. Add DNS servers:
    \textcolor{root}{(chroot) root#} \textcolor{command}{echo} "nameserver 89.233.43.71" > \textcolor{file}{/etc/resolv.conf}

4. MISC
4.1 Mount boot partition:
    \textcolor{root}{(chroot) root#} \textcolor{command}{mount} \textcolor{block}{/dev/sda2} \textcolor{dir}{/boot/}
4.2a Install Portage files:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge-webrsync}
4.2b Install Portage files in \textcolor{dir}{/var/db/repos/}:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge --sync}
4.3 Eselect news:
    \textcolor{root}{(chroot) root#} \textcolor{command}{eselect} news <list|read| purge>

5. hardened Gentoo:
5.1 Eselect set profile (hardened):
    \textcolor{root}{(chroot) root#} \textcolor{command}{eselect} profile <list | set <N>>
5.2 Source profile
    \textcolor{root}{(chroot) root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
5.3 Emerge hardened packages:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --oneshot gcc
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --oneshot binutils virtual/libc
5.4 make sure hardened GCC is selected:
    \textcolor{root}{(chroot) root#} \textcolor{command}{gcc-config} -l
5.5 Source new hardened profile:
    \textcolor{root}{(chroot) root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
5.6 Uninstall prelink package - not compatible with hardened linux:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --depclean prelink
5.7 Reinstall all packages with hardened GCC:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --emptytree --verbose @world
5.8 Update all packages:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask --update --deep --with-bdeps=y --changed-use 
    --keep-going @world


6. Timezone, locales and 
6.1 Set timezone:
    \textcolor{root}{(chroot) root#} \textcolor{command}{ls} \textcolor{dir}{/usr/share/zoneinfo/}
    \textcolor{root}{(chroot) root#} \textcolor{command}{echo} "Europe/Helsinki" > \textcolor{file}{/etc/timezone}
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --config sys-libs/timezone-data
6.2 Configure locales:
    File: \textcolor{file}{/etc/locale.gen}
en_US ISO-8859-1
en_US.UTF-8 UTF-8
    \textcolor{root}{(chroot) root#} \textcolor{command}{locale-gen}
    \textcolor{root}{(chroot) root#} \textcolor{command}{locale} -a
    \textcolor{root}{(chroot) root#} \textcolor{command}{eselect} locale <list|set <en_US.utf8>>
    # locales can be found in: \textcolor{file}{/etc/env.d/02locale}
6.3 Update environment
    \textcolor{root}{(chroot) root#} \textcolor{command}{env-update} && source \textcolor{file}{/etc/profile} && export PS1="(chroot) \$\{PS1\}"
\end{Verbatim}

\section{Configure fstab}
\begin{Verbatim}[commandchars=\\\{\}]
1. see UUIDs of block devices:
    \textcolor{root}{(chroot) root#} \textcolor{command}{blkid}

2. configure \textcolor{file}{/etc/fstab}:
File (\textcolor{file}{/etc/fstab}) (0644):
\textcolor{comment}{# <fs>          <mountpoint>    <type>      <opts>          <dump/pass>}
\textcolor{comment}{# UUID of /dev/sdX2}
UUID="<UUID>"   /boot           vfat        auto,noatime    1 2
\textcolor{comment}{# UUID of /dev/mapper/vg0-swap}
UUID="<UUID>"   none            swap        sw              0 0 
\textcolor{comment}{# UUID of /dev/mapper/vg0-root}
UUID="<UUID>"   /               ext4        defaults        0 1
\end{Verbatim}

\section{Configure and build Kernel}
Supported kernel source:
\begin{itemize}
    \item \textbf{sys-kernel/gentoo-sources}
    \item \textbf{sys-kernel/genkernel}
    \item \textbf{app-admin/eclean-kernel}
    \item \textbf{sys-boot/grub}
    \item \textbf{sys-kernel/linux-firmware}
    \item \textbf{sys-fs/lvm2}
    \item \textbf{sys-fs/cryptsetup}
    \item \textbf{app-admin/doas}
\end{itemize}

\subsection{Build kernel}
To get info about system see chapter (\underline{\ref{hw-detection}})
\begin{Verbatim}[commandchars=\\\{\}]
1. Create kernel \textcolor{file}{.config}:
    \textcolor{root}{(chroot) root#} \textcolor{dir}{/usr/src/linux#} \textcolor{command}{make} menuconfig

\textcolor{comment}{# initramfs}
\textcolor{block}{General setup  --->}
    \textcolor{block}{[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support}

\textcolor{comment}{# LVM support + encryption}
\textcolor{block}{Device Drivers  --->}
   \textcolor{block}{Multiple devices driver support (RAID and LVM)  --->}
       \textcolor{block}{<*> Device mapper support}
           \textcolor{block}{<*> Crypt target support}
           \textcolor{block}{<*> Snapshot target}
           \textcolor{block}{<*> Mirror target}
           \textcolor{block}{<*> Multipath target}
               \textcolor{block}{<*> I/O Path Selector based on the number of in-flight I/Os}
               \textcolor{block}{<*> I/O Path Selector based on the service time}

\textcolor{block}{Cryptographic API --->}
    \textcolor{block}{<*> XTS support}
    \textcolor{block}{<*> SHA224 and SHA256 digest algorithm}
    \textcolor{block}{<*> AES cipher algorithms}
    \textcolor{block}{<*> User-space interface for hash algorithms}
    \textcolor{block}{<*> User-space interface for symmetric key cipher algorithms}

2. Compile kernel:
    \textcolor{root}{(chroot) root#} \textcolor{command}{make} [-j8] && make [-j8] modules_install
    

3. Copy kernel image to \textcolor{dir}{/boot/} via:
    \textcolor{root}{(chroot) root#} \textcolor{command}{make} install
\end{Verbatim}

\section{Generate initramfs}
\begin{Verbatim}[commandchars=\\\{\}]
1. Build initramfs only (\textcolor{file}{/boot/initramfs-*-gentoo.img}):
    \textcolor{root}{(chroot) root#} \textcolor{command}{genkernel} --lvm --luks --install
    --kernel-config=<\textcolor{file}{/boot/config-*-gentoo}> initramfs
\end{Verbatim}

\section{Remove old kernel}
\begin{Verbatim}[commandchars=\\\{\}]
1. Install package:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} [--ask] app-admin/eclean-kernel

2. Keep 1 newest kernel:
    \textcolor{root}{(chroot) root#} \textcolor{command}{eclean-kernel} -n <1>
\end{Verbatim}


\section{Install GRUB2}
\begin{Verbatim}[commandchars=\\\{\}]
1. Add grub to device mapper:
     \textcolor{root}{(chroot) root#} \textcolor{command}{echo} "sys-boot/grub:2 device-mapper" >>
     \textcolor{file}{/etc/portage/package.use/sys-boot}

2. Edit GRUB config:
For full config see section (\underline{\ref{grub.conf}})
File (\textcolor{file}{/etc/default/grub}) (0644):

\textcolor{comment}{# crypto_LUKS fs block device (/dev/sdX3):}
GRUB_CMDLINE_LINUX="dolvm crypt_root=UUID=</dev/sdX3>"
\textcolor{comment}{# Try doing something with crypt_swap=UUID:}

3. Install GRUB for EFI:
    \textcolor{root}{(chroot) root#} \textcolor{command}{grub-install} --target=x86_64-efi --efi-directory=\textcolor{dir}{/boot/}

4. Create grub.cfg:
    \textcolor{root}{(chroot) root#} \textcolor{command}{grub-mkconfig} -o \textcolor{file}{/boot/grub/grub.cfg}
\end{Verbatim}


\section{Finalizing}
\begin{Verbatim}[commandchars=\\\{\}]
1. Password for root:
    \textcolor{root}{(chroot) root#} \textcolor{command}{passwd}  [root]

2. Remove Stage 3 tarball:
    \textcolor{root}{(chroot) root} \textcolor{dir}{/#} \textcolor{command}{rm} \textcolor{file}{stage3-*}

3. Add LVM to boot:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} [--ask] sys-fs/lvm2
    \textcolor{root}{(chroot) root#} \textcolor{command}{rc-update} add lvm default

4. Add dmcrypt to boot:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} [--ask] sys-fs/cryptsetup 
    \textcolor{root}{(chroot) root#} \textcolor{command}{rc-update} add dmcrypt boot
 
5.1 Add normal user:
    \textcolor{root}{(chroot) root#} \textcolor{command}{useradd} -m <USER>
    \textcolor{root}{(chroot) root#} \textcolor{command}{passwd} <USER>
    \textcolor{root}{(chroot) root#} \textcolor{command}{usermod} -aG wheel,usb,video,audio <USER>
5.2 Add doas:
    \textcolor{root}{(chroot) root#} \textcolor{command}{emerge} --ask app-admin/doas
5.3 Add doas rights to group :wheel:
File (\textcolor{file}{/etc/doas.conf}) (0644):
permit nopass :wheel    
    
6. Umount and reboot:
    \textcolor{root}{(chroot) root#} \textcolor{command}{exit}
    \textcolor{root}{root#} \textcolor{command}{umount} -R \textcolor{dir}{/mnt/gentoo}
    \textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}


\chapter{System Upgrade}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Kernel Upgrade}
\begin{Verbatim}[commandchars=\\\{\}]
Make sure, that \textcolor{dir}{/boot/} is mounted!
\end{Verbatim}
\subsection{Generate new kernel}
\begin{Verbatim}[commandchars=\\\{\}]
1. Create kernel \textcolor{file}{.config}:
    \textcolor{root}{root} \textcolor{dir}{/usr/src/linux#}  \textcolor{command}{make} menuconfig

- OPTIONAL for error:
    \textcolor{root}{root#} \textcolor{dir}{/usr/src/linux#} \textcolor{command}{make} clean

2. Compile kernel:
    \textcolor{root}{root} \textcolor{dir}{/usr/src/linux#} \textcolor{command}{make} [-j8] && make [-j8] modules_install
    
3. Copy kernel image to \textcolor{dir}{/boot/} via:
    \textcolor{root}{root} \textcolor{dir}{/usr/src/linux#} \textcolor{command}{make} install
    
- See kernel message after boot:
    \textcolor{root}{root#} \textcolor{command}{dmesg}
\end{Verbatim}
\subsection{Generate inirtamfs}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{genkernel} --lvm --luks --install
    --kernel-config=<\textcolor{file}{/boot/config-*-gentoo}> initramfs
\end{Verbatim}

\subsection{Update GRUB2}
\label{update-grub}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{grub-mkconfig} -o \textcolor{file}{/boot/grub/grub.cfg}
\end{Verbatim}

\subsection{Remove old kernel}
Files:\newline
\begin{itemize}
    \item \textcolor{file}{/lib/modules/\$\{old\_kernel\}}
    \item \textcolor{file}{/usr/src/linux-\$\{old\_kernel\}}
\end{itemize}
\begin{Verbatim}[commandchars=\\\{\}]
1. Keep 1 newest kernel:
    \textcolor{root}{root#} \textcolor{command}{eclean-kernel} -n <1>
    
2. Remove old files:
    \textcolor{root}{root#} \textcolor{command}{find} /boot/ -regex ".*\char092.old\$" -exec rm \{\} +
\end{Verbatim}


\section{Modules}
\subsection{List Modules}
\begin{Verbatim}[commandchars=\\\{\}]
List loaded modules:
    \textcolor{root}{root#} \textcolor{command}{lsmod}

Info about module:
    \textcolor{root}{root#} \textcolor{command}{modinfo} <module>
    
Find all modules:
    \textcolor{root}{root#} \textcolor{command}{find} <\textcolor{dir}{/}|\textcolor{dir}{/lib/modules/\$(uname -r/)}> -regex ".*\char092.k?o" 2> \textcolor{block}{/dev/null}
\end{Verbatim}

\subsection{[Un]Load Module}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{modprobe} [-r|--remove] <module>
\end{Verbatim}

\subsection{Auto-load Module}
\begin{Verbatim}[commandchars=\\\{\}]
File \textcolor{file}{/etc/modules-load.d/<networking>.conf}:

iwlwifi
...
\end{Verbatim}
\subsection{Blacklist Module}
\begin{Verbatim}[commandchars=\\\{\}]
File \textcolor{file}{/etc/modprobe.d/<blacklist>.conf}:

blacklist uhci_hcd
blacklist nvidia
\end{Verbatim}


\section{Package Update}
See section (\underline{\ref{package-update}})





\chapter{Hardware Detection}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\label{hw-detection}
\section{Packages}
\begin{itemize}
    \item \textbf{sys-apps/dmidecode}
    \item \textbf{sys-apps/inxi}
    \item \textbf{sys-apps/hwinfo}
    \item \textbf{sys-apps/usbutils}
    \item \textbf{sys-apps/lm-sensors}
    \item \textbf{sys-power/acpitool}
    \item \textbf{app-portage/cpuid2cpuflags}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{block}{Device Drivers  --->}
    \textcolor{block}{-*- I2C support  --->}
        \textcolor{block}{<*>   I2C device interface}
    \textcolor{block}{<*> Hardware Monitoring support  --->}
        \textcolor{block}{Select a driver, e.g.:}
        \textcolor{block}{[*] Intel Core/Core2/Atom temperature sensor (coretemp)}
\end{Verbatim}
\end{itemize}
\section{All}
\textbf{Info:} All, including battery
\begin{Verbatim}[commandchars=\\\{\}]
# filter [ON/OFF] = [-z|-Z]
    \textcolor{root}{root#} \textcolor{command}{inxi} -v8 [-z|-Z] [-c32]
\end{Verbatim}

\section{Chassis + System}
\textbf{Info:} Manufacturer, Version, Serial Number, [Boot Info]
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t chassis [-t system]
\end{Verbatim}

\section{Power Supply}
\textbf{Info:} Max Power Capacity (Watts)
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t 39
\end{Verbatim}

\section{Fan}
\textbf{Info:} Fan Status, RPM
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t 27
\end{Verbatim}

\section{Baseboard = Motherboard}
\textbf{Info:} Manufacturer, Version, Serial Number
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t baseboard
\end{Verbatim}

\section{FIRMWARE - BIOS}
\textbf{Info:} Vendor, Version, ROM size, Characteristics, Language
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t bios
\end{Verbatim}

\section{CPU}
\textbf{Info:} Manufacturer, Version, Clocks, Cache, Cores, Characteristics (64-bit, Multi-Core, Virtualization)
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t processor -t cache
\end{Verbatim}
\textbf{Info:} Architecture, Endianness, Cores, Model, Virtualization Caches, Vulnerabilities
\begin{Verbatim}[commandchars=\\\{\}]
   \textcolor{root}{root#} <\textcolor{command}{lscpu} | \textcolor{command}{less} \textcolor{file}{/proc/cpuinfo}>
\end{Verbatim}
\textbf{CPU Flags:}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{cpuid2cpuflags}
\end{Verbatim}
\textbf{Info:} CPU Temperature
\begin{Verbatim}[commandchars=\\\{\}]
1. Refresh every 2 seconds without title from watch:
    \textcolor{root}{root#} \textcolor{command}{watch} [-t] [-n 2] sensors
\end{Verbatim}

\section{RAM}
\textbf{Info:} Max Capacity, Number of RAMs, Size of RAMs, DDR Type, Speed
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t memory
\end{Verbatim}

\section{Hard Drive}
\textbf{Info:} Model, Vendor, Driver
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --disk
\end{Verbatim}

\section{Graphical Card}
\textbf{Info:} Model, Vendor, Drivers
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --gfxcard
    \textcolor{root}{root#} \textcolor{command}{lspci} | grep -i VGA
\end{Verbatim}

\section{PCI, I/O, BUS}
    \begin{itemize}
    \item Port Type
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{dmidecode} -t connector
    \end{Verbatim}
    \item Ethernet/Wifi (Vendor, Model, Driver, MAC, Permanent MAC)
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --netcard [--network]
    \end{Verbatim}
    \item Bluetooth (Speed)
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --bluetooth
    \end{Verbatim}
    \item HUB - hot-plug USB (Version)
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --usb
    \textcolor{user}{user\$} \textcolor{command}{lsusb}
    \end{Verbatim}
    \item Mouse, Keyboard (/dev/input/eventX)
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --keyboard --mouse
    \end{Verbatim}
    \item Monitor (Vendor, Resolution, Size, Frequencies)
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --monitor
    \end{Verbatim}
    \item Sound (Model, Vendor, Driver
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{rot#} \textcolor{command}{lspci} | grep -i audio
    \textcolor{root}{root#} \textcolor{command}{hwinfo} --sound
    \end{Verbatim}
    \item Camera
    \begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{user}{user\$} \textcolor{command}{vlc} <\textcolor{block}{/dev/videoX}>
    \end{Verbatim}
\end{itemize}

\section{Battery}
\begin{Verbatim}[commandchars=\\\{\}]
Battery status:
    \textcolor{root}{root#} \textcolor{command}{acpitool} <-B||--battery>
\end{Verbatim}



\chapter{Local Settings}
\section{Hostname}
\begin{Verbatim}[commandchars=\\\{\}]
0. Check hostname:
    \textcolor{root}{root#} \textcolor{command}{hostname}
    
1. Change hostname in \textcolor{file}{/etc/conf.d/hostname}
hostname="<HOSTNAME">

2. Reboot
    \textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}

\section{No MOTD}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{[root#} \textcolor{command}{echo} "" > \textcolor{file}{/etc/issue}
\end{Verbatim}



\section{Timezone}
\begin{Verbatim}[commandchars=\\\{\}]
     \textcolor{root}{root#} \textcolor{command}{echo} "UTC" > \textcolor{file}{/etc/timezone}
     \textcolor{root}{root#} \textcolor{command}{emerge} --config sys-libs/timezone-data
\end{Verbatim}

\section{Locale}
\begin{Verbatim}[commandchars=\\\{\}]
- Locale (\textcolor{file}{/etc/env.d/locale}):
    \textcolor{root}{root#} \textcolor{command}{locale}
LANG=en_US.utf8                 # global lang
LC_CTYPE="en_US.utf8"           
LC_NUMERIC="en_US.utf8"         # thousand, decimal separator
LC_TIME="en_US.utf8"            # time and date
LC_COLLATE="en_US.utf8"
LC_MONETARY="en_US.utf8"        # currency
LC_MESSAGES="en_US.utf8"
LC_PAPER="en_US.utf8"           # a4, letter...
LC_NAME="en_US.utf8"
LC_ADDRESS="en_US.utf8"
LC_TELEPHONE="en_US.utf8"
LC_MEASUREMENT="en_US.utf8"
LC_IDENTIFICATION="en_US.utf8"  
LC_ALL=                         # other
\end{Verbatim}

\section{Keyboard Layout}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{/etc/conf.d/keymaps}) (0644) from \textcolor{dir}{/usr/share/keymaps/}:
keymap="us"
    \textcolor{root}{root#} \textcolor{command}{rc-service} keymaps restart
\end{Verbatim}


\chapter{Network}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}
    \item \textbf{net-misc/dhcpcd}
    \item \textbf{net-analyzer/macchanger}
\end{itemize}
\section{Rename Network Interface}
\begin{Verbatim}[commandchars=\\\{\}]
0. (OPTIONAL) find builtin MAC and NAME:
    \textcolor{root}{root#} \textcolor{command}{udevadm} test-builtin net_id \textcolor{dir}{/sys/class/net/<enp3s0>/} 2> \textcolor{block}{/dev/null}

1. Rename interface names, overwrite \textcolor{file}{/lib/udev/rules.d/80-net-name-slot.rules} with:
    \textcolor{root}{root#} \textcolor{command}{touch} \textcolor{file}{/etc/udev/rules.d/80-net-name-slot.rules}
    
2. File \textcolor{file}{/etc/udev/rules.d/80-net-name-slot.rules}:
\textcolor{comment}{# eth0:}
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", \char092
<ATTR{address}=="<MAC-ADDRESS>"|ENV{ID_NET_NAME_PATH}=="<enp3s0>">, \char092
ATTR{type}=="1", KERNEL=="eth*", NAME="<eth0>"
\textcolor{comment}{# wireless:}
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", \char092
<ATTR{address}=="<MAC-ADDRESS>"|ENV{ID_NET_NAME_PATH}=="<wlp0s20f3>">, \char092
ATTR{type}=="1", KERNEL=="wlan*", NAME="<wlan0>"

3. Reboot
    \textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}

\section{Network Interface - UP, DHCP, DNS}
\subsection{Stop Autorun}
\begin{Verbatim}[commandchars=\\\{\}]
- Stop autorun DHCP:
    \textcolor{root}{root#} \textcolor{command}{rc-update} delete dhcpcd

- Stop autorun network interfaces:
File (\textcolor{file}{/etc/rc.conf}) (0644):
\textcolor{comment}{# do not auto start network interface}
rc_hotplug="!net.wlan0 !net.eth0"
rc_dhcpcd_provide="!net"
\end{Verbatim}

\subsection{Configure IP options}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{/etc/conf.d/net}) (0644):

\textcolor{comment}{# Prefer Module (iproute2):}
\textcolor{comment}{# do not use module: modules="!iwconfig"}
modules="iproute2"

\textcolor{comment}{# DHCP module for interface <eth0> (prefer dhcpd):}
\textcolor{comment}{modules_<eth0>="dhcpcd"}
\textcolor{comment}{# Timeout after 10 seconds}
\textcolor{comment}{#dhcpcd_<eth0>="-t 10"}
\textcolor{comment}{# DNS with DHCP:}
\textcolor{comment}{#dhcp_<eth0>="release nodns nontp nonis"}

\textcolor{comment}{# DHCP module for interface <wlan00> (prefer dhcpd):}
\textcolor{comment}{#modules_<wlan0>="dhcpcd"}
\textcolor{comment}{#dhcp_<wlan0>="release nodns nontp nonis"}

\textcolor{comment}{# DHCP vs STATIC vs NULL}
\textcolor{comment}{#config_<eth0>="dhcp"}
\textcolor{comment}{#config_<eth0>="<192.168.0.11/24>"}
\textcolor{comment}{#routes_<eth0>="default via <192.168.0.1>"}
\textcolor{comment}{#dns_servers_<eth0>="<1.1.1.1 1.0.0.1>"}
config_<eth0>="null"
config_<wlan0>="null"

\textcolor{comment}{# Wireless DHCP}
modules_<wlan0>="wpa_supplicant"
\textcolor{comment}{#config_<wlan0>="dhcpcd"}
\end{Verbatim}



\subsection{DNS}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{resolv.conf}) (0644):
\textcolor{comment}{# Uncensored DNS - Denmark - Unicast}
nameserver 89.233.43.71
#nameserver 1.1.1.1
#nameserver 1.0.0.1
\textcolor{comment}{# CZ.NIC}
nameserver 193.17.47.1
nameserver 185.43.135.1
\end{Verbatim}

\section{RUN ETH0}
\begin{Verbatim}[commandchars=\\\{\}]
0.A Optional change MAC:
    \textcolor{root}{root#} \textcolor{command}{macchanger} -Ab <eth0>
0.B Optional change MAC manually:
    \textcolor{root}{root#} \textcolor{command}{ip} (l)ink set address <XX:XX:XX:XX:XX:XX> dev <eth0>
    
1. Turn on interface:
    \textcolor{root}{root#} \textcolor{command}{ip} l set <eth0> up

2. Add IP:
2.A) dhcp:
2.A.1 Delete previous lease:
    \textcolor{root}{root#} \textcolor{command}{rm} -f \textcolor{file}{/var/lib/dhcpcd/<eth0>.lease}
2.A.2 Request IPv4 address:
    \textcolor{root}{root#} \textcolor{command}{dhcpcd} -4 -C resolv.conf <eth0>

2.B static:
    \textcolor{root}{root#} \textcolor{command}{ip} a add <192.168.0.111/24> dev <eth0>
    \textcolor{root}{root#} \textcolor{command}{ip} r add default via <192.168.0.1>
\end{Verbatim}


\section{Disable sit0 interface}
Do not built module 'sit' in kernel.
\begin{Verbatim}[commandchars=\\\{\}]
Networking support --->
  Networking options --->
    < - > The IPv6 protocol --->

1. File \textcolor{file}{/etc/modprobe.d/aliases.conf}:

\textcolor{comment}{# uncomment:}
alias net-pf-10 off         # IPv6

2. Reboot:
    \textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}



\section{WiFi (iwlwifi)}
\begin{itemize}
    \item \textbf{sys-kernel/linux-firmware}
    \item \textbf{net-wireless/iw}
    \item \textbf{net-wireless/wpa\_supplicant}
    \item \textbf{net-wireless/aircrack-ng}
\end{itemize}
\underline{\url{https://wireless.wiki.kernel.org/en/users/drivers/iwlwifi}}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{IEEE 802.11:}
\textcolor{block}{[*] Networking support  --->}
    \textcolor{block}{[*] Wireless  --->}
        \textcolor{block}{<M>   cfg80211 - wireless configuration API}
        \textcolor{block}{[*]   enable powersave by default}
        \textcolor{block}{<M>   Generic IEEE 802.11 Networking Stack (mac80211)}

\textcolor{comment}{# iwlwifi:}
\textcolor{block}{Device Drivers  --->}
    \textcolor{block}{[*] Network device support  --->}
        \textcolor{block}{--- Network device support}
        \textcolor{block}{[*]   Wireless LAN  --->}
            \textcolor{block}{--- Wireless LAN}
            \textcolor{block}{[*]   Intel devices}
            \textcolor{block}{<M>   Intel Wireless WiFi Next Gen AGN -}
            \textcolor{block}{d-N/Ultimate-N (iwlwifi)}
                \textcolor{block}{<M>   Intel Wireless WiFi DVM Firmware support}
                \textcolor{block}{<M>   Intel Wireless WiFi MVM Firmware support}
\end{Verbatim}
\subsection{Modules}
\begin{Verbatim}[commandchars=\\\{\}]
1. File \textcolor{file}{/etc/portage/savedconfig/sys-kernel/linux-firmware}

\textcolor{comment}{# Comment unused ucodes with "sed 's/^/#/' linux-firmware > linux-firmware2"}

2. To apply future changes rename file:
    \textcolor{root}{root} \textcolor{dir}{/etc/portage/savedconfig/sys-kernel#} \textcolor{command}{mv} linux-firmware* linux-firmware 
    
3. Autoload module:
    \textcolor{root}{root#} \textcolor{command}{mkdir} \textcolor{dir}{/etc/modules-load.d/}
    \textcolor{root}{root#} \textcolor{command}{echo} "iwlwifi" > \textcolor{file}{/etc/modules-load.d/<wifi>.conf}
\end{Verbatim}

\subsection{WPA\_supplicant conf}
\begin{Verbatim}[commandchars=\\\{\}]
1.1 File \textcolor{file}{/etc/wpa_supplicant/wpa\_supplicant.conf}

\textcolor{comment}{# Allow users in the 'wheel' group to control wpa_supplicant}
ctrl\_interface=DIR=/var/run/wpa\_supplicant GROUP=wheel
\textcolor{comment}{# Make this file writable for wpa\_gui / wpa_cli}
update\_config=1

1.2 Change mod to 600:
    \textcolor{root}{roo#t} \textcolor{command}{chmod} 600 \textcolor{file}{/etc/wpa_supplicant/wpa\_supplicant.conf}

OPTIONAL. Start wpa\_supplicant on start:
    \textcolor{root}{root#} \textcolor{command}{rc-update} add wpa\_supplicant
    
OPTIONAL. Run wpa\_supplicant to see, if interface was loaded:
    \textcolor{root}{root#} \textcolor{command}{wpa\_cli}
    
4.1 Setup for dhcpcd (-B background, -M for wireless, -c for filename)
\textcolor{file}{/etc/conf.d/wpa_supplicant}:
wpa_supplicant_args="-B -M -c/etc/wpa_supplicant/wpa_supplicant.conf"

4.2 \textcolor{file}{/etc/conf.d/net}:
\textcolor{comment}{# Wireless DHCP}
modules_<wlan0>="wpa_supplicant"
#config_<wlan0>="dhcpcd"
\end{Verbatim}


\subsection{Find ESSID+PSK}
\begin{Verbatim}[commandchars=\\\{\}]
0. List wireless interfaces:
    \textcolor{root}{root#} \textcolor{command}{iw} dev

0.5 Change MAC:
    \textcolor{root}{root#} \textcolor{command}{macchanger} -Ab wlan0

1. Wireless NIC to monitoring mode:
    \textcolor{root}{root#} \textcolor{command}{iw} <wlan0> set type <monitor|managed>
    \textcolor{root}{root#} \textcolor{command}{rfkill} unblock <ID>
    \textcolor{root}{root#} \textcolor{command}{ip} l set <wlan0> up

2. Search for BSSID (show WPS, show Uptime, show ab = 2.4 GHz, g = 5GHz):
    \textcolor{root}{root#} \textcolor{command}{airodump-ng} [-W] [-U] [--band abg] <wlan0mon>

!!! Cracking - monitor BSSID (keep running):
    \textcolor{root}{root#} \textcolor{command}{airodump-ng} -c <CHANNEL> --bssid <BSSID> -w <CAPTURE-FILE> <wlan0mon>
!!! Deauthentication to get handshake:
    \textcolor{root}{root#} \textcolor{command}{aireplay-ng} --deauth=<SECONDS> -a <AP BSSID> -c <Client MAC>
    [--ignore-negative-one] <wlan0mon>
!!! Crack with handshake:
    \textcolor{root}{root#} \textcolor{command}{aircrack-ng} --bssid <BSSID> -w <DICTIONARY> <CAPTURE-FILE>
    
3. Return from monitor mode:
    \textcolor{root}{root#} \textcolor{command}{airmon-ng} stop <wlan0mon>
\end{Verbatim}

\subsection{Create config file for ESSID}
\begin{Verbatim}[commandchars=\\\{\}]
1. SSID + Password:
A) Edit via wpa\_passphrase:
    \textcolor{root}{root#} \textcolor{command}{wpa_passphrase} '<ssid>' '[passphrase]'
    
B) File \textcolor{file}{/etc/wpa_supplicant/wpa\_supplicant.conf}:
\textcolor{comment}{Lower prio = preffered}
\textcolor{comment}{# WPA-PSK network config}
network=\{
    ssid="<SSID>"
    scan_ssid=1
    key_mgmt=WPA-PSK
    psk="<PASSWORD>"
    priority=1
\}

network=\{
    ssid=""
    key_mgmt=NONE
    priority=2
\}

\end{Verbatim}

\section{RUN WLAN0}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{macchanger} -Ab <wlan0>
    \textcolor{root}{root#} \textcolor{command}{rfkill} unblock <TYPE|ID>
    * \textcolor{root}{root#} \textcolor{command}{iw} <wlan0> set type managed
    * \textcolor{root}{root#} \textcolor{command}{ip} l set <wlan0> up
    \textcolor{root}{root#} \textcolor{command}{rm} \textcolor{file}{/var/lib/dhcpcd/*}
    \textcolor{root}{root#} \textcolor{command}{rc-service} wpa_supplicant start
    \textcolor{root}{root#} \textcolor{command}{dhcpcd} -4 -C resolv.conf [-W 192.168.0.1] wlan0
\end{Verbatim}



\section{Bluetooth - WiP}
\begin{itemize}
    \item \textbf{sys-kernel/linux-firmware}
    \item \textbf{net-wireless/bluez}
\end{itemize}
\subsection{Kernel}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{block}{[*] Networking support --->}
      \textcolor{block}{<M>   Bluetooth subsystem support --->}
              \textcolor{block}{[*]   Bluetooth Classic (BR/EDR) features}
              \textcolor{block}{<*>     RFCOMM protocol support}
              \textcolor{block}{<*>     HIDP protocol support}
              \textcolor{block}{[*]     Bluetooth High Speed (HS) features}
              \textcolor{block}{[*]   Bluetooth Low Energy (LE) features}
                    \textcolor{block}{Bluetooth device drivers --->}
                      \textcolor{block}{<M> HCI USB driver}
                      \textcolor{block}{<M> HCI UART driver}
      \textcolor{block}{<*>   RF switch subsystem support --->}
    \textcolor{block}{Device Drivers --->}
          \textcolor{block}{HID support --->}
            \textcolor{block}{<*>   User-space I/O driver support for HID subsystem}
\end{Verbatim}
\subsection{USE flag}
\begin{Verbatim}[commandchars=\\\{\}]
1. File \textcolor{file}{/etc/portage/make.conf}

USE="bluetooth"

2. update packages with USE:
    \textcolor{root}{root} \textcolor{command}{emerge} --ask --changed-use --deep @world

3. Run bluetooth:
3.1 load module:
    \textcolor{root}{root} \textcolor{command}{modprobe} bluetooth
3.2 Run service:
    \textcolor{root}{root} \textcolor{command}{rc-service} bluetooth start
3.3 Run bluetooth:
    \textcolor{root}{root} \textcolor{command}{bluetoothctl}
\end{Verbatim}






\chapter{Portage}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}
    \item \textbf{sys-apps/portage} - emerge
    \item \textbf{app-portage/gentoolkit} - equery
\end{itemize}
\section{Info about System}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask --verbose
\end{Verbatim}

\section{Package Listing}
@world file: \textcolor{file}{/var/lib/portage/world}
\subsection{List All Portage Sets}
\begin{Verbatim}[commandchars=\\\{\}]
- List sets:
    \textcolor{root}{root#} \textcolor{command}{emerge} --list-sets
    
- List packages in set:
    \textcolor{root}{root#} \textcolor{command}{emerge} --pretend [--verbose] <@SET>
\end{Verbatim}

\subsection{List All Installed Packages}
\begin{Verbatim}[commandchars=\\\{\}]
- [I]nstalled, ebuild [R]epo, [v]erbose, [S]lot[Subslot]
    \textcolor{root}{root#} \textcolor{command}{qlist} -IRv [-S[S]
\end{Verbatim}

\subsection{Files And Packages}
\begin{Verbatim}[commandchars=\\\{\}]
- Find in which package file belongs (dpkg -S <PACKAGE>):
    \textcolor{root}{root#} \textcolor{command}{equery} (b)elongs <\textcolor{file}{/PATH/FILE}>
    
- Find [executable] files, that package created:
    \textcolor{root}{root#} \textcolor{command}{equery} (f)iles [--filter=cmd] <PACKAGE>
\end{Verbatim}

\subsection{Packages Dependencies}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{equery} <(d)epends|dep(g)raph> <PACKAGE>
\end{Verbatim}

\subsection{Package Size}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{equery} (s)ize <PACKAGE>
\end{Verbatim}

\section{Package Search, Install, Remove}
\begin{Verbatim}[commandchars=\\\{\}]
1. Search for package:
    \textcolor{root}{root#} \textcolor{command}{emerge} <--search|--searchdesc> "\%<REGEX>"
    
2.A) Install package [without adding to @world]:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask [--verbose|--quiet] [--oneshot|-1] <PACKAGE>
2.B) Install specific version:
    \textcolor{root}{root#} \textcolor{command}{emerge} -a -v <=www-client/firefox-24.8.0>
2.C) Install with USE flag:
    \textcolor{root}{root#} USE="<FLAG>" emerge -a -v <PACKAGE>
2.D) install package from specific repository:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask <CATEGORY>/<ATOM>::<REPOSITORY-NAME>
    
3.1 Remove package from @world:
    \textcolor{root}{root#} \textcolor{command}{emerge} --deselect <PACKAGE>
3.2 Clean dependencies:
    \textcolor{root}{root#} \textcolor{command}{emerge} [--ask] --depclean
\end{Verbatim}

\section{Package Update}
\label{package-update}
Watch changes: \underline{\url{https://packages.gentoo.org/arches/amd64/keyworded}}
\begin{Verbatim}[commandchars=\\\{\}]
0.A) Synchronize repos into \textcolor{dir}{/var/db/repos/gentoo/}:
    \textcolor{root}{root#} \textcolor{command}{emerge} --sync
0.B) Download repos as tarball:
    \textcolor{root}{root#} \textcolor{command}{emerge-webrsync}

1.A) Update:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask [--verbose|--quiet] --update --deep
    --changed-use --keep-going --with-bdeps=y @world

1.B) Short:
    \textcolor{root}{root#} \textcolor{command}{emerge} -a [-v|-q] -u -D -U --keep-going --with-bdeps=y @world

2. Configure (if necessary):
    \textcolor{root}{root#} \textcolor{command}{dispatch-conf}
Use or Zap -> 'U'|'Z'

3. Clean:
    \textcolor{root}{root#} \textcolor{command}{emerge} --depclean
\textcolor{file}{/etc/portage/make.conf -> \$\{DISTDIR\}}
    \textcolor{root}{root#} \textcolor{command}{eclean-dist} --deep
\textcolor{file}{/etc/portage/make.conf -> \$\{PKGDIR\}}
    \textcolor{root}{root#} \textcolor{command}{eclean-pkg} --deep

4. Clean Other Files (if necessary):
    \textcolor{dir}{/var/tmp/portage/}
    \textcolor{dir}{/var/cache/distfiles/}
    \textcolor{dir}{/var/cache/binpkgs/}
\end{Verbatim}

\section{Source Code}
\begin{Verbatim}[commandchars=\\\{\}]
- Path to ebuild:
    \textcolor{root}{root#} \textcolor{command}{equery} (w)hich <PACKAGE>
    
- Use ebuild:
    \textcolor{root}{root#} \textcolor{command}{ebuild} \textcolor{file}{<PATH-TO/EBUILD>.ebuild} fetch
    \textcolor{root}{root#} \textcolor{command}{ebuild} \textcolor{file}{<PATH-TO/EBUILD>.ebuild} unpack
    # edit source code here if wanted:
    # (\textcolor{dir}{/var/tmp/portage/app-editors/<XXX>/work/<XXX>/src/})
    \textcolor{root}{root#} \textcolor{command}{ebuild} \textcolor{file}{<PATH-TO/EBUILD>.ebuild} compile
    \textcolor{root}{root#} \textcolor{command}{ebuild} \textcolor{file}{<PATH-TO/EBUILD>.ebuild} install
    \textcolor{root}{root#} \textcolor{command}{ebuild} \textcolor{file}{<PATH-TO/EBUILD>.ebuild} qmerge
\end{Verbatim}

\section{Masking Package}
\subsection{Masking}
\begin{Verbatim}[commandchars=\\\{\}]
Edit file \textcolor{file}{/etc/portage/package.mask}

\textcolor{comment}{# Mask newer packages than ati-drivers-12.6_beta_pre897}
>x11-drivers/ati-drivers-12.6_beta_pre897

\textcolor{comment}{Mask repository}
*/*::<REPOSITORY-NAME>
\end{Verbatim}
\subsection{Unamsking}
\begin{Verbatim}[commandchars=\\\{\}]
Edit file \textcolor{file}{/etc/portage/package.unmask}

<CATEGORY>/<ATOM>::<REPOSITORY-NAME>
\end{Verbatim}

\subsection{Testing for specific package}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{/etc/portage/package.accept_keywords}):

www-client/librewolf
\end{Verbatim}



\section{Repositories}
\underline{\url{https://gpo.zugaina.org/Overlays}}\newline
\begin{itemize}
    \item \textbf{app-admin/eselect} - eselect
    \item \textbf{app-poratage/layman} - layman (sync-plugin-portage git)
    \item \textbf{sys-apps/portage} - emaint
    \item \textbf{app-portage/eix} - eix
\end{itemize}
File to configure: \textcolor{dir}{/etc/portage/repos.conf/}\newline
Available Packages (gentoo): \textcolor{dir}{/var/db/repos/}\newline
Available other repos: \textcolor{dir}{/var/lib/layman/}

\subsection{List Repositories}
\begin{Verbatim}[commandchars=\\\{\}]
All available overlays:
    \textcolor{root}{root#} \textcolor{command}{layman} -L
    
Locally installed overlays:
    \textcolor{root}{root#} \textcolor{command}{layman} -l
    
List all packages in Overlay:
    \textcolor{root}{root#} \textcolor{command}{eix-update}
    \textcolor{root}{root#} \textcolor{command}{eix} --in-overlay <OVERLAY-NAME>
\end{Verbatim}

\subsection{Add/Delete Repository}
\begin{Verbatim}[commandchars=\\\{\}]
Add overlay:
    \textcolor{root}{root#} \textcolor{command}{layman} -a <OVERLAY-NAME>
    
Delete overlay:
    \textcolor{root}{root#} \textcolor{command}{layman} -d <OVERLAY-NAME>
\end{Verbatim}

\subsection{Update Repository}
\begin{Verbatim}[commandchars=\\\{\}]
Update specific overlay:
    \textcolor{root}{root#} \textcolor{command}{layman} -s <OVERLAY-NAME>
    
Update ALL repositories:
    \textcolor{root}{root#} \textcolor{command}{layman} <-S|-s ALL>
\end{Verbatim} 



\chapter{Optimalization}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Licenses}
\underline{\url{https://wiki.gentoo.org/wiki/License_groups}}
\subsection{Global Licenses}
Edit file \textcolor{file}{/etc/portage/make.conf}:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# ACCEPT only Free software}
ACCEPT_LICENSE="-* @FREE"
\end{Verbatim}
\subsection{License per package}
Edit file: \textcolor{file}{/etc/portage/package.license}:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# Accepting google-chrome license for www-client/google-chrome for version}
\textcolor{comment}{# equal or greater than 42.0.2311.90_p1}
>=www-client/google-chrome-42.0.2311.90_p1 google-chrome

\textcolor{comment}{# Accepting google-chrome license for any version of www-client/google-chrome}
www-client/google-chrome google-chrome

\textcolor{comment}{# Accepting google-chrome license for every www-client package at any version}
www-client/* google-chrome

\textcolor{comment}{# Accepting google-chrome license for every package at any version}
*/* google-chrome

\textcolor{comment}{# Accepting every license for every package at any version}
*/*  *
\end{Verbatim}

\section{Mirrors}
\underline{\url{https://www.gentoo.org/downloads/mirrors/}}\newline
Edit file: \textcolor{file}{/etc/portage/make.conf}:
\begin{Verbatim}[commandchars=\\\{\}]
GENTOO_MIRRORS="rsync://rsync.mirrorservice.org/distfiles.gentoo.org/"
\end{Verbatim}





\section{USE Flags}
\subsection{USEFLAGS in Pacakge}
\begin{Verbatim}[commandchars=\\\{\}]
- Info about USE flags:
    \textcolor{root}{root#} \textcolor{command}{euse} --info
+/- = active/inactive
C/c = is enabled/disabled in make.conf

- Find package [not installed] with USE flag:
    \textcolor{root}{root#} \textcolor{command}{equery} (h)asuse [-pI [-o]] <FLAG>
    
- Find FLAGS in package:
    \textcolor{root}{root#} \textcolor{command}{equery} (u)ses <PACKAGE>
\end{Verbatim}


\subsection{make.conf}
\label{make.conf}
\underline{\url{https://dev.gentoo.org/~zmedico/portage/doc/man/make.conf.5.html}}\newline
File \textcolor{file}{/etc/portage/make.conf}:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# Do not edit variables here: /usr/share/portage/config/make.globals}
\textcolor{comment}{# Flags for C, C++, FORTRAN77 and FORTRAN applications}
\textcolor{comment}{# Do not use ’-march=native’ with distcc}
#CHOST="x86_64-pc-linux-gnu"
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="\$\{CFLAGS\}"
FCFLAGS="\$\{CFLAGS\}"
FFLAGS="\$\{CFLAGS\}"

\textcolor{comment}{# Parallel "make" jobs = CPUs, load average}
MAKEOPTS="-j8 -l8" 
\textcolor{comment}{# Default emerge options}
EMERGE_DEFAULT_OPTS="--jobs=8  --load-average=8 --keep-going --with-bdeps=y"

\textcolor{comment}{# Set niceness to be lower a little}
PORTAGE_NICENESS=-1

\textcolor{comment}{# Features - greater parallelization}
FEATURES="parallel-install"

\textcolor{comment}{# Gentoo Mirror}
GENTOO_MIRRORS="rsync://rsync.mirrorservice.org/distfiles.gentoo.org/"
\textcolor{comment}{# Accept ONLY Free Software}
ACCEPT_LICENSE="-* @FREE"

\textcolor{comment}{# Overwritten by /etc/portage/package.use}
USE="-aqua -a52 -emacs -xemacs -gnome -gnome-keyrings \char092
-ios -ipod -kde -neon -systemd -vcd -zeroconf -ipv6 \char092
elogind crypt X bluetooth unicode \char092
hardened lm-sensors zsh-completion bindist"

\textcolor{comment}{################### X #############}
\textcolor{comment}{# GFX card: nouveau|nvidia|intel}
VIDEO_CARDS="nouveau intel i965 iris"

\textcolor{comment}{# For mouse, keyboard, and Synaptics touchpad support}
INPUT_DEVICES="libinput synaptics"


1. Update after change:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask --changed-use --deep @world
\end{Verbatim}


\subsection{pacakge.use}
\label{package.use}
File \textcolor{file}{/etc/portage/package.use}:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# Required by www-client/firefox (argument)}
>=media-libs/libpng-1.6.37 apng

1. Update after change:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask --changed-use --deep @world
\end{Verbatim}

\section{Build Pacakge with Special Options}
\begin{Verbatim}[commandchars=\\\{\}]
1. Specific compile config for 1 package:
File \textcolor{file}{/etc/portage/env/<NAME>.conf}:
\textcolor{comment}{# Change makeopts}
MAKEOPTS="-j1"

2. Use specific conf for package:
File \textcolor{file}{/etc/portage/package.env}:
<CATTEGORY>/<ATOM> <NAME>.conf
\end{Verbatim}




\chapter{OpenRC + Processes}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{itemize}
    \item \textbf{sys-process/glances}
\end{itemize}
\section{OpenRC}
\begin{Verbatim}[commandchars=\\\{\}]
OpenRC process: \textcolor{file}{/sbin/init}

Run levels (\textcolor{dir}{/etc/runlevels/}:
sysinit - system specific: \textcolor{dir}{/dev/} \textcolor{dir}{/proc/} \textcolor{dir}{/sys/}, also mounts \textcolor{dir}{/lib/rc/init.d/} as ramdisk
boot - services that mount fs, set init state of peripherals, or logging.
default - normal use
\end{Verbatim}

\subsection{List OpenRC Services}
\begin{Verbatim}[commandchars=\\\{\}]
-A) Available services (by runlevels):
    \textcolor{root}{root#} \textcolor{command}{rc-status} -s
-B)
    \textcolor{root}{root#} \textcolor{command}{rc-update} [-v|--verbose] show
    
- Started services:
    \textcolor{root}{root#} \textcolor{command}{rc-status} -a
    
- Unused services:
    \textcolor{root}{root#} \textcolor{command}{rc-status} -u
\end{Verbatim}

\subsection{Add/Remove service to runlevel}
\begin{Verbatim}[commandchars=\\\{\}]
Services must be under \textcolor{dir}{/etc/init.d/} or \textcolor{dir}{/usr/local/etc/init.d}
Service also must contains: "#!/sbin/openrc-run"

- Add service:
    \textcolor{root}{root#} \textcolor{command}{rc-update} <add|delete> <SERVICE> <RUNLEVEL>
\end{Verbatim}

\subsection{Restart OpenRC}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{openrc}
\end{Verbatim}

\subsection{Config}
ConfigFile: \textcolor{file}{/etc/rc.conf}\newline
Default LogFile: \textcolor{file}{/var/log/rc.log}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# Parallel boot}
rc_parallel="YES"

\textcolor{comment}{# Log rc process to logfile /var/log/rc.log}
rc_logger="YES"
\textcolor{comment}{# Specify custom logfile}
#rc_log_path="/var/log/rc.log"
\textcolor{comment}{# Verbose Output}
rc_verbose=yes

\textcolor{comment}{# unicode support}
unicode="YES"
\end{Verbatim}



\section{Processes}
Dir with processes: \textcolor{dir}{/proc/}

\subsection{Init}
File with init settings: \textcolor{file}{/etc/inittab}
\begin{Verbatim}[commandchars=\\\{\}]
- See runlevel of process (init):
RUN LEVELS:
0 = shut down system
1 = single-user mode (no network, no daemons, no multiuser)
2 = multi-user mode (no network, no daemons)
3 = normal mode
4 = Undefined
5 = X11
6 = reboot
    \textcolor{root}{root#} \textcolor{command}{runlevel} <init>

- Change runlevel:
     \textcolor{root}{root#} \textcolor{command}{init} <RUN-LEVEL>
\end{Verbatim}


\subsection{List all processes}
\begin{Verbatim}[commandchars=\\\{\}]
- List all Processes:
    \textcolor{root}{root#} \textcolor{command}{ps} -eF
- List Processes in tree (kthreadd vs init):
    \textcolor{root}{root#} \textcolor{command}{ps} -ejH

- List init porcesses in tree [-p for PID, -C for color]:
    \textcolor{root}{root#} \textcolor{command}{pstree} [-p] [-C age]
    
- Get PID of process:
    \textcolor{root}{root#} \textcolor{command}{pidof} <KEYWORD>
    
- PID of current process
    \textcolor{root}{root#} \textcolor{command}{\$\$}
\end{Verbatim}

\subsection{Kill Process}
\begin{Verbatim}[commandchars=\\\{\}]
- Kill SIGTERM[/SIGKILL] Process:
    \textcolor{root}{root#} \textcolor{command}{kill} [-9] <PID>

- Kill all processes by keyword:
    \textcolor{root}{root#} \textcolor{command}{killall} [-I|--ignore-case] <KEYWORD>
\end{Verbatim}

\subsection{Process Utilization}
\begin{Verbatim}[commandchars=\\\{\}]
- Top
    \textcolor{root}{root#} \textcolor{command}{htop}

- Htop, File with config: \textcolor{file}{~/.config/htop/htoprc}
    \textcolor{root}{root#} \textcolor{command}{htop}
    
- Glances
    \textcolor{root}{root#} \textcolor{command}{glances}
\end{Verbatim}

\subsection{Change Niceness}
\begin{Verbatim}[commandchars=\\\{\}]
- Run program with niceness (default 10 = priority 20+10=30):
    \textcolor{root}{root#} \textcolor{command}{nice} -n <-20;19> <COMMAND>

- Change program niceness:
    \textcolor{root}{root#} \textcolor{command}{renice} -n <-20;19> <COMMAND>
\end{Verbatim}


\subsection{Jobs}
\begin{Verbatim}[commandchars=\\\{\}]
- Show jobs [with PID] in current shell environment:
    \textcolor{root}{root#} \textcolor{command}{jobs} [-l]

- Process to background
- From start:
    \textcolor{root}{root#} \textcolor{command}{<COMMAND>} &
- When Running:
    Ctrl + Z

- Process to foreground:
    \textcolor{root}{root#} \textcolor{command}{fg} <JOB>

- Kill job:
    \textcolor{root}{root#} \textcolor{command}{kill} \%<JOB>
\end{Verbatim}



\chapter{System Hardening}%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CHAPTER %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\underline{\url{https://wiki.gentoo.org/wiki/Security_Handbook}}



\section{Network - WiP}
\subsection{Firewall}
\begin{Verbatim}[commandchars=\\\{\}]
DROP - no response; REJECT - closed port
1 L3 FW:
    \textcolor{root}{root#} \textcolor{command}{iptables} -L [-n -v]
- Flush all settings:
    \textcolor{root}{root#} \textcolor{command}{iptables} -F
1.1 Default policy:
    \textcolor{root}{root#} \textcolor{command}{iptables} -P <INPUT|OUTPUT> <ACCEPT|DROP>
1.2 Disable ICMP OUTPUT:
    \textcolor{root}{root#} \textcolor{command}{iptables} -A INPUT -p icmp -j DROP
1.3 Block specific IP:
    \textcolor{root}{root#} \textcolor{command}{iptables} -A INPUT [-p <tcp|udp>] -s <IPv4> -j DROP
1.4 Block specific port:
    \textcolor{root}{root#} \textcolor{command}{iptables} -A INPUT -p <tcp|udp> --dport <PORT> -j DROP

2. DNS FW:
File \textcolor{file}{/etc/hosts}
0.0.0.0 google.com
\end{Verbatim}



\section{Bluetooth}
\begin{Verbatim}[commandchars=\\\{\}]
- List all Wireless devices:
    \textcolor{root}{root#} \textcolor{command}{rfkill} list

- Start bluetooth:
    \textcolor{root}{root#} \textcolor{command}{modprobe} bluetooth
    \textcolor{root}{root#} \textcolor{command}{rc-service} bluetooth start
    \textcolor{root}{root#} \textcolor{command}{bluetoothctl}

Change name:
\textcolor{file}{/etc/bluetooth/main.conf}
Name = <NAME>


- Block bluetooth:
rfkill <unblock|block> <ID>

- Use
1.A) scan for devices:
    \textcolor{root}{[bluetooth]#} scan <on|off>
1.B) be discoverable:
    \textcolor{root}{[bluetooth]#} discoverable <on|off>
    
2. Pair:
    \textcolor{root}{[bluetooth]#} info <mac ADDRESS>
    \textcolor{root}{[bluetooth]#} pair <mac ADDRESS>
    \textcolor{root}{[bluetooth]#} trust <mac ADDRESS>
    \textcolor{root}{[bluetooth]#} connect <mac ADDRESS>
\end{Verbatim}


\section{Web Browser}
\url{https://gitlab.com/librewolf-community/browser/gentoo#readme}

\section{Vulnerabilities}
\subsection{Hardware check}
\subsection{Rootkit check}

\section{Logging}
\subsection{MOTD}
\begin{Verbatim}[commandchars=\\\{\}]
No Message on login screen:
    \textcolor{root}{[root#} \textcolor{command}{echo} "" > \textcolor{file}{/etc/issue}
\end{Verbatim}


\section{Local Passwords}

\section{Kernel Hardening}

\section{Proxy, VPN and Tor}

\section{Normal user}
group wheel

\section{MESS}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}






\chapter{Customization}
\label{grub.conf}
\section{GRUB}
\subsection{Config Variables}
Edit config variables in \textcolor{file}{/etc/default/grub}:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{# command line arguments to add to menu entries for kernel}
GRUB_CMDLINE_LINUX="dolvm crypt_root=UUID=<UUID of \textcolor{block}{/dev/sdX3>}"

\textcolor{comment}{# highlighted default entry}
GRUB_DEFAULT=0
\textcolor{comment}{# boot default entry in X seconds, 0=immediately, -1=never}
GRUB_TIMEOUT=-1
\textcolor{comment}{# menu=timeout to select entry, hidden=timeout to show grub}
GRUB_TIMEOUT_STYLE=menu
\textcolor{comment}{# disable recovery menu entry}
GRUB_DISABLE_RECOVERY=true
\textcolor{comment}{# GRUB BG image (*.jpg or *.png) - gfxterm only}
GRUB_BACKGROUND="\textcolor{file}{/boot/grub/<image.png>}"
\textcolor{comment}{# Theme - gfxterm only}
#GRUB_THEME="\textcolor{file}{/boot/grub/themes/<THEME>/theme.txt}"
\end{Verbatim}
\subsection{Menu Colors}
\textbf{Colors:} black, blue, green, cyan, red, magenta, brown, light-gray.\newline
\textbf{+FG colors:} dark-gray, light-blue, light-green, light-cyan, light-red, light-magenta, yellow, white.\newline
Edit config variables in \textcolor{file}{/boot/grub/custom.cfg}:
\begin{Verbatim}[commandchars=\\\{\}]
set color_normal=<foreground>/<background>
set color_highlight=<foreground>/<background>
set menu_color_normal=<foreground>/<background>
set menu_color_highlight=<foreground>/<background>
\end{Verbatim}

\subsection{Custom Theme}

\subsection{Update}
See section (\underline{\ref{update-grub}})

\section{OpenRC Processes}
%setterm --powersave off 
%[setterm --blank 0
%setterm --powerdown 0]
\begin{Verbatim}[commandchars=\\\{\}]
- Numlock after start
    \textcolor{root}{root#} \textcolor{command}{rc-update} add numlock default
\end{Verbatim}


\section{Power Saving}
\begin{Verbatim}[commandchars=\\\{\}]
setterm terminfo
\end{Verbatim}


\section{Zshell}

\subsection{Select zsh}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}


\subsection{Configure zsh}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}



\chapter{Sound}
\underline{\url{https://wiki.gentoo.org/wiki/PulseAudio}}\newline
\section{Kernel}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{block}{Device Drivers  --->}
    \textcolor{block}{<*> Sound card support  --->}
        \textcolor{block}{<*> Advanced Linux Sound Architecture  --->}
            \textcolor{block}{(2048) Pre-allocated buffer size for HD-audio driver}

\textcolor{comment}{# Needed to avoid errors with PulseAudio}
\textcolor{block}{General setup  --->}
    \textcolor{block}{Timers subsystem  --->}
        \textcolor{block}{[*] High Resolution Timer Support}

\textcolor{comment}{# Access to audio}        
\textcolor{block}{File systems  --->}
   \textcolor{block}{Pseudo filesystems  --->}
      \textcolor{block}{[*] Tmpfs virtual memory file system support (former shm fs)}
      \textcolor{block}{[*] Tmpfs POSIX Access Control Lists}
\end{Verbatim}

\section{USE Flag}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{/etc/portage/make.conf}) (0644):
USE="pulseaudio"

\end{Verbatim}


\chapter{X + i3}
\section{X}
\begin{itemize}
    \item \textbf{x11-base/xorg-server}
    \item \textbf{x11-base/xorg-drivers}
    \item \textbf{x11-apps/xrandr}
\end{itemize}

\subsection{Kernel}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{block}{Device Drivers --->}
  \textcolor{block}{Input device support --->}
  \textcolor{block}{<*>  Event interface}
  
\textcolor{comment}{# GFX card (NVIDIA)}
\textcolor{block}{Device Drivers --->}
   \textcolor{block}{Graphics support --->}
      \textcolor{block}{<M/*>  Nouveau (NVIDIA) cards}
\end{Verbatim}

\subsection{Config make.conf}
\begin{Verbatim}[commandchars=\\\{\}]
File \textcolor{file}{/etc/portage/make.conf}
USE="X elogind"

\textcolor{comment}{# GFX card: nouveau|nvidia|intel}
VIDEO_CARDS="nouveau"
\textcolor{comment}{# For mouse, keyboard, and Synaptics touchpad support}
INPUT_DEVICES="libinput synaptics"
\end{Verbatim}

\subsection{Install}
\begin{Verbatim}[commandchars=\\\{\}]
1. After installing packages - environment update
    \textcolor{root}{root#} \textcolor{command}{env-update}
    \textcolor{root}{root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
\end{Verbatim}

\subsection{Change Screen resolution}
\begin{Verbatim}[commandchars=\\\{\}]
1. Get info about supported resolutions:
    \textcolor{root}{roo#} \textcolor{command}{xrandr}
    
2. Change Resolution:
    \textcolor{root}{root#} \textcolor{command}{xrandr} --output \$(xrandr -q | grep ’ connected’ | head -n 1 | cut -d ’ ’ -f1) \char92
    --mode <1920x1080>
\end{Verbatim}

\subsection{Start X on startup}
\begin{Verbatim}[commandchars=\\\{\}]
File \textcolor{file}{~/.bash_profile}
\textcolor{comment}{# if (length of \$DISPLAY is 0 && \$(tty) = /dev/tty1) startx}
if [[ -z \$DISPLAY ]] && [[ \$(tty) = /dev/tty1 ]]; then exec startx; fi
\end{Verbatim}

\section{SUID startx for non-root}
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{chmod} 4755 \textcolor{file}{/usr/bin/startx}
\end{Verbatim}

\section{Non root Xorg}
\begin{Verbatim}[commandchars=\\\{\}]
1.1 Verify elogind is working porperly:
    \textcolor{root}{root#} \textcolor{command}{loginctl} user-status
    Failed to connect to bus: No such file or directory:
    
1.2

\textcolor{root}{root#} \textcolor{command}{chmod} 4755 \textcolor{file}{/usr/bin/startx}
\end{Verbatim}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{i3}
\underline{\url{https://i3wm.org/docs/userguide.html}}\newline
\begin{itemize}
    \item \textbf{x11-misc/i3-gaps}     - i3wm
    \item \textbf{x11-misc/dmenu}       - dmenu
    \item \textbf{x11-misc/i3blocks}    - bar
    \item \textbf{x11-misc/i3lock}      - lock screen
    \item display manager - login screen
    \item \textbf{x11-apps/xprop}       - properties of X window
    \item \textbf{x11-aps/xev}          - keys captured by X
    \item \textbf{x11-apps/xset}        - stop power saving
    \item \textbf{x11-apps/xbacklight}  - set brightness
    \item \textbf{media-gfx/feh}        - set wallpaper
    \item \textbf{media-gfx/scrot}      - take screenshot
    \item \textbf{x11-terms/rxvt-unicode} - terminal emulator
    \item \textbf{x11-misc/numlockx} - toggle numlock in x
    \item x11-misc/xclip
    \item lxde-base/lxappearance - change theme and cursor
\end{itemize}
\subsection{Configure for X}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.xinitrc}) (0644):
\textcolor{comment}{# Disable power saving}
xset s off
xset s noblank
xset -dpms
\textcolor{comment}{# execute i3 WM}
exec i3

- Config files:
1. \textcolor{file}{~/.i3/config}
2. \textcolor{file}{/etc/i3/config}
\end{Verbatim}

\subsection{Identify keys captured by X}
\begin{Verbatim}[commandchars=\\\{\}]
    \textcolor{root}{root#} \textcolor{command}{xev}
\end{Verbatim}

\subsection{Brightness}
\textbf{- Script to not go under 10\% of brightness:}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/<brightness.sh>}) (0755):

#!/usr/bin/env sh

if [ "\$(xbacklight -get | cut -d'.' -f1)" -le "10" ]
then
    xbacklight -set 10
else
    xbacklight -dec 10
fi
\end{Verbatim}
\textbf{- Adjust Brightness in i3:}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Startup brightness}
exec xbacklight -set 50
\textcolor{comment}{# Regulate brightness with Fn+F5 and Fn+F6}
bindsym X86MonBrightnessUp exec xbacklight -inc 10
bindsym X86MonBrightnessDown exec ~/.config/i3/brightness.sh
\end{Verbatim}

\subsection{Shortcuts}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Set mod key}
\textcolor{comment}{# Window key = Mod4; Alt key = Mod1}
set \$mod Mod4
\textcolor{comment}{# Better Exit that to confirm with mouse}
#bindsym \$mod+Shift+e exec killall -9 startx
\end{Verbatim}

\subsection{numlock}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Numlock on on start of i3}
exec numlockx on
\end{Verbatim}





\subsection{Printscreen}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.scripts/prtsc.sh}) (0744):
#!/usr/bin/env sh
if [ -d ~/.screenshots/ ]
then
    scrot --silent --pointer ~/.screenshots/\$(date '+\%Y-\%m-\%d_\%H:\%M\%S').png
else
    mkdir -p ~/.screenshots/
    scrot --silent --pointer ~/.screenshots/\$(date '+\%Y-\%m-\%d_\%H:\%M\%S').png
fi

File (\textcolor{file}{~/.config/i3/config}) (0644):
bindsym Print exec ~/.scripts/prtsc.sh
\end{Verbatim}



\subsection{Font}
\underline{\url{https://github.com/adobe-fonts/source-code-pro}}

\begin{itemize}
    \item \textbf{dev-vcs/git}
\end{itemize}


\begin{Verbatim}[commandchars=\\\{\}]
Find all installed fonts:
    \textcolor{root}{root#} \textcolor{command}{fc-list}

CUSTOM font:
1. Create fonts directory:
    \textcolor{user}{user\$} \textcolor{command}{mkdir} \textcolor{dir}{~/.fonts/}
 
2. Download font:
    \textcolor{user}{user\$} \textcolor{command}{git} clone https://github.com/adobe-fonts/source-code-pro
    
3. copy all .ttf to font directory:
    \textcolor{user}{user\$} \textcolor{command}{cp} \textcolor{file}{~/source-code-pro/TTF/*.ttf} \textcolor{dir}{~/.fonts/}

4. Set new font in i3:
File \textcolor{file}{~/.config/i3/config} (0644):
\textcolor{comment}{# Change font}
#font pango:monospace 8
font pango:Source Code Pro Bold 10
\end{Verbatim}


\subsection{Wallpaper}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# set wallpaper}
exec feh --bg-scale <PATH/To/IMAGE>/png
\textcolor{comment}{# Setup with i3-gaps to render nicely}
exec --no-startup-id exec bash \$\{HOME\}/.fehbg
for_window [class="."] border pixel 3
hide_edge_borders both
\end{Verbatim}


\subsection{Gaps}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# set gaps for between windows}
gaps inner 10
gaps outer 10
\textcolor{comment}{Add gaps only, when container > 1}
smart_gaps on
\end{Verbatim}

\subsection{Workspaces}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Set workspaces as variables}
set \$workspace1 "<1: Terminals>
set \$workspace2 "<2: Firefox>

\textcolor{comment}{# Rename Workspace}
#bindsym \$mod+1 workspace number \$ws1
bindsym \$mod+1 workspace \$workspace1
bindsym \$mod+2 workspace \$workspace2
#bindsym \$mod+Shift+1 move container to workspace number \$ws1
bindsym \$mod+Shift+1 move container to workspace \$workspace1
bindsym \$mod+Shift+2 move container to workspace \$workspace2

\textcolor{comment}{# Open specific App in specific workspace}
assign [class="<Firefox>"] \$workspace2

- Find WM_CLASS of X app (2nd variable)
    \textcolor{root}{root#} \textcolor{command}{xprop}
\end{Verbatim}

\subsection{Window Borders}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Color variables}
set \$selected-color    #ffd369
set \$unselected-color  #393e46
set \$urgent-color      #bd2000
\textcolor{comment}{# Attach colors to windows}
\textcolor{comment}{#                       border      bg                 text        indicator}
client.focused          #000000     \$selected-color    #000000     \$urgent-color
client.unfocused        #000000     \$unselected-color  #000000     #000000
client.focused_inactive #000000     \$unselected-color  #000000     #000000
client.urgent           #000000     \$urgent-color      #000000     #000000
\end{Verbatim}


\subsection{i3bar}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Set colors for i3}
set \$bar-bg    #222831
\textcolor{comment}{# Configure i3bar}
bar \{
    \textcolor{comment}{use i3blocks script in bar}
    status_command i3blocks -c ~/.config/i3/i3blocks.conf
    \textcolor{comment}{position of bar top|bottom}
    position top
    separator_symbol "/"
    
    
    colors \{
        background  \$bg-color
        separator   \#selected-color
        \textcolor{comment}{# Color of text in i3bar}
        #statusline  
        
        \textcolor{comment}{#                   border             bg                 text}
        focused_workspace   \$selected-color    \$selected-color    \$unselected-color
        inactive_workspace  \$unselected-color  \$unselected-color  \$selected-color
        urgent_workspace    \$urgent-color      \$urgent-color      #ffffff
    \}
\}
\end{Verbatim}

\subsection{i3blocks}
\underline{\url{https://vivien.github.io/i3blocks/}}
\begin{Verbatim}[commandchars=\\\{\}]
- Copy \textcolor{file}{/etc/i3blocks.conf} to \textcolor{dir}{~/.config/i3/}:
    \textcolor{root}{root#} \textcolor{command}{cp} \textcolor{file}{/etc/i3blocks.conf} \textcolor{dir}{~/.config.i3/}

- Edit file (\textcolor{file}{~/.config/i3/i3blocks.conf}
\textcolor{comment}{# Separator + separator's interval}
separator=true
separator_block_width=15
\textcolor{comment}{# Custom properties}
[time]
command=date '+\%Y-\%m-\%d \%H:\%M:\%S'
interval=1
color=#ffd369

[cpu]
...

\textcolor{comment}{# To do}
CPU
RAM
netork - ifaces, IPs, Speed Up Down
temperatures

File (\textcolor{file}{!/.config/i3/cpu.sh}) (0755):

\end{Verbatim}

\subsection{i3lock}
\begin{Verbatim}[commandchars=\\\{\}]
- '-e' = ignore empty passwords; '-f' show failed attempts; '-u' !unlock indicator
    \textcolor{root}{root#} \textcolor{command}{i3lock} [-i <PATH/To/IMAGE>.png] [-e] [-f] [-u]
    
File (\textcolor{file}{~/.config/i3/config}) (0644):
bindsym \$mod+l exec i3lock -i <IMAGE>.png -efu
\end{Verbatim}


%%%%%

\subsection{Dmenu}
\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.config/i3/config}) (0644):
\textcolor{comment}{# Customize dmenu}
bindsym \$mod+D exec dmenu_run -b -fn monospace -nb "#393e46" -nf "#ffd369" \char92
-sb "#ffd369" -sf "#393e46" -i
\end{Verbatim}
\subsection{Display Manager}


\subsection{Terminal emulator - \$\{TERM\}}
\begin{Verbatim}[commandchars=\\\{\}]
1. File (\textcolor{file}{/etc/portage/package.use/urxvt}) (0644):
x11-terms/rxvt-unicode 256-color blink fading-colors gdk-pixbuf xtf

2. Update after changed USE flags:
    \textcolor{root}{root#} \textcolor{command}{emerge} --ask --changed-use --deep --with-bdeps=y @world

3. Create config file for rxvt-unicode:
File (\textcolor{file}{~/.Xresources}):
\textcolor{comment}{! Xft: Antialiasing and DPI}
Xft.antialias: true
Xft.dpi:    100

\textcolor{comment}{! Font}
URxvt.font: xft:monospace:size=12
\textcolor{comment}{! Disable Scrollbar}
URxvt.scrollBar: false
\textcolor{comment}{! Transparency - higher value = higher transparency}
URxvt.transparent: true
URxvt.shading: 50
\textcolor{comment}{! Fade unfocused window}
URxvt.fading: 30
\textcolor{comment}{! Line space}
URxvt.lineSpace: 0
\textcolor{comment}{! Colors}
URxvt*background: #000000
URxvt*foreground: #ffffff
\textcolor{comment}{! Other colors}

4. Refresh X database for file and restart urxvt:
    \textcolor{root}{root#} \textcolor{command}{xrdb} \textcolor{file}{~/.Xresources}
    
5. Execute read in X database every time i3 is started:
File (\textcolor{file}{~/.config/i3/config}):
exec xrdb ~/.Xresources
\end{Verbatim}
\subsubsection{Copy Paste}
\textbf{Paste - Ctrl+Shift+V:}

\begin{Verbatim}[commandchars=\\\{\}]
File (\textcolor{file}{~/.Xresources}) (0644):
URxvt.iso14755: False
URxvt.keysym.Shift-Control-V: eval:paste_clipboard
URxvt.keysym.Shift-Control-C: eval:selection_to_clipboard
\textcolor{comment}{# Disable is also needed for copy paste to work}
URxvt.keysym.Control-Meta-c: builtin-string:
URxvt.keysym.Control-Meta-v: builtin-string:
\end{Verbatim}





\subsection{ToDo}
\begin{Verbatim}[commandchars=\\\{\}]
Better i3lock
Add properties to i3blocks
Gfx card
Display manager + tty login scren motd change
\end{Verbatim}




\section{Apps for multimedia}
\begin{Verbatim}[commandchars=\\\{\}]
Images - feh
Audio
Video

git clone https://github.com/posva/catimg
catimg# cmake .
catimg# make install
rm -rf ~/catimg/
\end{Verbatim}





\chapter{Apps}
Core:
\begin{itemize}
    \item \textbf{sys-kernel/gentoo-sources}
    \item \textbf{sys-kernel/genkernel}
    \item \textbf{app-admin/eclean-kernel}
    \item \textbf{sys-boot/grub}
    \item \textbf{sys-kernel/linux-firmware}
    \item \textbf{sys-fs/lvm2}
    \item \textbf{sys-fs/cryptsetup}
    \item \textbf{app-admin/doas}
    \item \textbf{dev-vcs/git}
\end{itemize}
HW detection:
\begin{itemize}
    \item \textbf{sys-apps/dmidecode}
    \item \textbf{sys-apps/inxi}
    \item \textbf{sys-apps/hwinfo}
    \item \textbf{sys-apps/usbutils}
    \item \textbf{sys-apps/lm-sensors}
    \item \textbf{sys-power/acpitool}
    \item \textbf{app-portage/cpuid2cpuflags}
\end{itemize}
System monitoring:
\begin{itemize}
    \item \textbf{sys-processes/htop}
    \item \textbf{sys-process/lsof} \# for more informative htop
    \item \textbf{app-misc/neofetch}
\end{itemize}
System:
\begin{itemize}
    \item \textbf{sys-block/parted}
    \item \textbf{sys-fs/dosfstools} - mkfs -t vfat
    \item \textbf{sys-fs/ntfs3g} - mkfs -t ntfs
    \item \textbf{media-gfx/imagemagick}
\end{itemize}
Portage:
\begin{itemize}
    \item \textbf{app-portage/gentoolkit}
\end{itemize}
Network Core:
\begin{itemize}
    \item \textbf{net-misc/dhcpcd}
    \item \textbf{sys-kernel/linux-firmware}
    \item \textbf{net-wireless/iw}
    \item \textbf{net-wireless/wpa\_supplicant}
    \item \textbf{net-wireless/bluez} - bluetooth
    \item \textbf{net-analyzer/macchanger}
    \item \textbf{net-wireless/aircrack-ng}
\end{itemize}
WIP:
Shell + Text editor
\begin{itemize}
    \item \textbf{app-editors/vim}
    \item \textbf{app-shells/zsh}
    \item \textbf{app-shells/zsh-completions}
    \item \textbf{app-shells/gentoo-zsh-completions}
\end{itemize}


\section{Vim}
\subsection{Config}
\begin{Verbatim}[commandchars=\\\{\}]
Config files:
\textcolor{file}{/etc/vim/vimrc} - global
\textcolor{file}{~/.vimrc} - per user

1. Set Text editor:
A) For whole system:
    \textcolor{root}{root#} \textcolor{command}{eselect} editor set <N>
B) for user only (\textcolor{file}{~/.bashrc}):
\textcolor{comment}{# Default editor vim}
export EDITOR="/usr/bin/vim"

2. Update variables:
\textcolor{root}{root#} \textcolor{command}{source} \textcolor{file}{/etc/profile}
\end{Verbatim}
\subsection{Tricks}
\begin{Verbatim}[commandchars=\\\{\}]
- Add '#' to start of file:
    :\%s/^/#/g
    \textcolor{root}{root#} \textcolor{command}{vim} -c ":\%s/^/#/g" -c ":wq" <FILE>
\end{Verbatim}


\section{Zsh}
\subsection{Config}
\begin{Verbatim}[commandchars=\\\{\}]


\end{Verbatim}


%

Network tools;
\begin{itemize}
    \item \textbf{net-analyzer/nmap}
    \item \textbf{net-analyzer/hping}
    \item \textbf{tshark}
    \item \textbf{ssh}
    \item \textbf{www-server/apache}
    
\end{itemize}



System:
\begin{itemize}

    
    \item \textbf{zsh}


    \item \textbf{vim}
    

    \item \textbf{hashcat}
    \item git + FontAwesome
\end{itemize}



\begin{Verbatim}[commandchars=\\\{\}]
EDITOR=app-editors/vim
X_EDITOR=atom
SHELL=ZSH
TERMINAL=TERMINATOR

DOAS

htop


librewolf
virt-manager
vlc/ffplay
keepass
OBS
SteaM
SSH/APache
Light Cord
Wireshark
Tor
ProtonVPN
Brightness
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
rc-update add numlock default

dev-vcs/git - git
\end{Verbatim}

\section{Bonus - text manipulation}
\begin{itemize}
    \item awk
    \item sed
    \item xargs
    \item sort
\end{itemize}


\chapter{Cstom Kernel}
\begin{Verbatim}[commandchars=\\\{\}]
Networking Support -> 
    Networking Options ->
        <> The IPv6 protocol


[*] Networking support --->
      <M>   Bluetooth subsystem support --->
              [*]   Bluetooth Classic (BR/EDR) features
              <*>     RFCOMM protocol support
              <*>     HIDP protocol support
              [*]     Bluetooth High Speed (HS) features
              [*]   Bluetooth Low Energy (LE) features
                    Bluetooth device drivers --->
                      <M> HCI USB driver
                      <M> HCI UART driver
      <*>   RF switch subsystem support --->
Device Drivers --->
          HID support --->
            <*>   User-space I/O driver support for HID subsystem

[*] Networking support  --->
    [*] Wireless  --->
        <M>   cfg80211 - wireless configuration API
        [*]     enable powersave by default
        <M>   Generic IEEE 802.11 Networking Stack (mac80211)

Device Drivers  --->
        [*] Network device support  --->
        --- Network device support
        [*]   Wireless LAN  --->
            --- Wireless LAN
            [*]   Intel devices
            <M>     Intel Wireless WiFi Next Gen AGN - 
            Wireless-N/Advanced-N/Ultimate-N (iwlwifi)
            <M>     Intel Wireless WiFi DVM Firmware support
            <M>     Intel Wireless WiFi MVM Firmware support

Device Drivers  --->
    -*- I2C support  --->
        <*>   I2C device interface
    <*> Hardware Monitoring support  --->
        Select a driver, e.g.:
        [*] Intel Core/Core2/Atom temperature sensor (coretemp)   
        
Device Drivers --->
  Input device support --->
  <*>  Event interface
Device Drivers  --->
  Input device support  --->
  <*>   Event interface
  [*]   Mice  --->
     <*>   PS/2 mouse   


Device Drivers --->
  Input device support --->
  <*>  Event interface
  
Device Drivers --->
   Graphics support --->
      <*> Direct Rendering Manager (Xfree86 4.1.0 and higher DRI support)
      <M/*>  Nouveau (NVIDIA) cards     
      
      
Device Drivers --->
   NVME Support --->
     <*> NVM Express block device

Processor type and features --->
   [*] Intel Low Power Subsystem Support
 Device Drivers --->
   Input device support --->
     [*] Mice --->
       <*> Synaptics I2C Touchpad support
     <*> Synaptics RMI4 bus support
     <*>   RMI4 I2C Support
     <*>   RMI4 SMB Support
     [*]   RMI4 Function 03 (PS2 Guest)
     [*]   RMI4 Function 11 (2D pointing)
     [*]   RMI4 Function 30 (GPIO LED)
     [*]   RMI4 Function 34 (Device reflash)
     [*]   RMI4 Function 54 (Analog diagnostics)
     -*-   RMI4 Function 55 (Sensor tuning)
   I2C Support --->
     -*- I2C support
        I2C Hardware Bus support --->
          <*> Intel 82801 (ICH/PCH)
          <*> SMBus Control Method Interface
          <*> Synopsys DesignWare Platform
          <*> Synopsys DesignWare PCI
   -*- Pin controllers --->
     <*> Intel Canon Lake PCH pinctrl and GPIO driver
   Multifunction device drivers --->
     <*> Intel Low Power Subsystem support in ACPI mode
     <*> Intel Low Power Subsystem support in PCI mode
   HID support
     -*- HID support
     <*> Generic HID driver
         Special HID drivers --->
           <*> Lenovo / ThinkPad devices
           <*> HID Multitouch panels
           
           <*> Speedlink VAD Cezanne mouse support
           
   [*] DMA Engine support --->
     <*> Intel integrated DMA 64-bit support
     -*- Synopsys DesignWare AHB DMA PCI driver
   [*] X86 Platform Specific Device Drivers --->
     <*> Lenovo IdeaPad Laptop Extras
     <*> ThinkPad ACPI Laptop Extras
     <*> WMI
     <*>   WMI embedded Binary MOF driver    
     
     
     
Device Drivers 
    [*] Pin Controllers
        <*> Intel Sunrisepoint pinctrl and GPIO driver

\end{Verbatim}


\end{document}
